<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Web 3 Demo</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <!--    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.0/web3.min.js"
            integrity="sha512-ppuvbiAokEJLjOUQ24YmpP7tTaLRgzliuldPRZ01ul6MhRC+B8LzcVkXmUsDee7ne9chUfApa9/pWrIZ3rwTFQ=="
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
</head>

<body>
<h1>lab 2 - 1000 logo Contract</h1>
<br>
<br>
<label for="name">
    <div>Name</div>
    <input id="name" type="text">
</label>
<label for="img">
    <div>Image link</div>
    <input id="img" type="text">
</label>
<button id="res" onclick="createToken(document.getElementById('name').value, document.getElementById('img').value);"
        class="div">Create token
</button>
<br>
<br>
<button id="che" onclick="checkToken();"
        class="div">Check token
</button>
<button id="lis" onclick="listItems();"
        class="div">List available items
</button>

<br>
<br>
<br>
<br>
<label for="tr">
    <div>To</div>
    <input id="tr" type="text">
</label>
<button id="tra" onclick="transferToken(tr)"
        class="div">Transfer your token
</button>
<script type="text/javascript">

    async function loadWeb3() {
        if (window.ethereum) {
            window.web3 = new Web3(window.ethereum);
            window.ethereum.enable();
        }
    }


    async function loadContract() {
        return new window.web3.eth.Contract([
            {
                "constant": false,
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "addr",
                        "type": "address"
                    },
                    {
                        "internalType": "address payable",
                        "name": "_from",
                        "type": "address"
                    }
                ],
                "name": "buy",
                "outputs": [],
                "payable": true,
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "addr",
                        "type": "address"
                    },
                    {
                        "internalType": "string",
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "internalType": "string",
                        "name": "image",
                        "type": "string"
                    }
                ],
                "name": "createToken",
                "outputs": [],
                "payable": true,
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "addr",
                        "type": "address"
                    },
                    {
                        "internalType": "string",
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "internalType": "string",
                        "name": "image",
                        "type": "string"
                    }
                ],
                "name": "modifyToken",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "addr",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "_to",
                        "type": "address"
                    }
                ],
                "name": "transferToken",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_owner",
                        "type": "address"
                    }
                ],
                "name": "checkToken",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    },
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            }
        ], "0xcB72916261E86Abcb66b2c776B5cEa9BEF0ca8f7");
    }

    async function createToken(name, img){
        const account = await getCurrentAccount();
        await window.contract.methods.createToken(account, name, img)
            .send({from: account, value: 1000000000000000000})
    }

    async function modifyToken(name, img){
        const account = await getCurrentAccount();
        await window.contract.methods.modifyToken(account, name, img).call()
    }

    async function transferToken(to){
        const account = await getCurrentAccount();
        await window.contract.methods.transferToken(account, to).call()
    }

    async function buy(from){
        const account = await getCurrentAccount();
        await window.contract.methods.buy(account, from)
            .send({from: account, value: 1000000000000000000})
    }

    async function checkToken(){
        const account = await getCurrentAccount();
        const token = await window.contract.methods.checkToken(account).call()
        if (token){
            alert("YOUR TOKEN:" + token)
        }
        else {
            alert("No tokens on your account")
        }
    }

    async function listItems(){
        const account = await getCurrentAccount();
        await window.contract.methods.listItems().call()
    }


    async function getCurrentAccount() {
        const accounts = await window.web3.eth.getAccounts();
        console.log(accounts[0])
        return accounts[0];
    }

    async function load() {
        await loadWeb3();
        window.contract = await loadContract();
    }



    load();
</script>

</body>

</html>